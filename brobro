-- Tekkit-Style Continuous Hover Titan Auto-Farm (Aot:R)
-- Client-side LocalScript

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

-- Configuration and Speed Tuning
local Options = {
    AutoFarm     = { Value = true },
    NapeExtender = { Value = true },
    HitboxSize   = { Value = 15 },        -- Enlarged vertical hitbox
    HoverHeight  = 100,                  -- Constant altitude above nape
    TweenTimes   = { Across = 0.5, Hover = 0.5 }  -- Seconds per tween (lower = faster)
}

-- References
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- Smooth hover using BodyPosition for a springy settle
local function smoothHover(part, targetPos, duration)
    local bodyPos = Instance.new("BodyPosition")
    bodyPos.Parent = part
    bodyPos.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    bodyPos.P = 3000
    bodyPos.D = 500
    bodyPos.Position = targetPos
    task.wait(duration)
    bodyPos:Destroy()
end

-- Horizontal move + hover tween (Tekkit style)
local function moveAndHover(part, targetPos)
    -- Anchor for stable tween
    part.Anchored = true
    -- Horizontal move
    local tween = TweenService:Create(
        part,
        TweenInfo.new(Options.TweenTimes.Across, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
        { CFrame = CFrame.new(targetPos) }
    )
    tween:Play()
    tween.Completed:Wait()
    -- Release and smooth hover
    part.Anchored = false
    smoothHover(part, targetPos, Options.TweenTimes.Hover)
end

-- Main auto-farm loop
local function autoFarm()
    -- Wait for Titans folder
    while not Workspace:FindFirstChild("Titans") do
        task.wait(1)
    end

    -- Initial ascend above first Titan
    if Options.AutoFarm.Value then
        local first = Workspace.Titans:FindFirstChildWhichIsA("Model")
        if first then
            local hitboxes = first:FindFirstChild("Hitboxes")
            local nape = hitboxes and hitboxes:FindFirstChild("Hit") and hitboxes.Hit:FindFirstChild("Nape")
            if nape then
                hrp.CFrame = CFrame.new(nape.Position + Vector3.new(0, Options.HoverHeight, 0))
                task.wait(0.2)
            end
        end
    end

    while Options.AutoFarm.Value do
        local titansFolder = Workspace:FindFirstChild("Titans")
        if not titansFolder then
            warn("[AutoFarm] Titans folder missing. Retrying...")
            task.wait(1)
        else
            -- Gather and sort Titans by distance
            local titanList = {}
            for _, titan in ipairs(titansFolder:GetChildren()) do
                local hitboxes = titan:FindFirstChild("Hitboxes")
                local hit = hitboxes and hitboxes:FindFirstChild("Hit")
                local nape = hit and hit:FindFirstChild("Nape")
                if nape then
                    table.insert(titanList, { titan = titan, nape = nape })
                end
            end
            table.sort(titanList, function(a, b)
                return (a.nape.Position - hrp.Position).Magnitude < (b.nape.Position - hrp.Position).Magnitude
            end)

            for _, entry in ipairs(titanList) do
                if not Options.AutoFarm.Value then break end
                local titan = entry.titan
                local nape = entry.nape
                -- Extend Nape
                if Options.NapeExtender.Value then
                    nape.Size = Vector3.new(Options.HitboxSize.Value, Options.HitboxSize.Value, Options.HitboxSize.Value)
                    nape.Transparency = 0.85
                    nape.CanCollide = false
                    print("[AutoFarm] Nape extended for:", titan.Name)
                end
                -- Calculate hover position
                local hoverPos = nape.Position + Vector3.new(0, Options.HoverHeight, 0)
                -- Move and hover
                moveAndHover(hrp, hoverPos)
                -- Attack
                firetouchinterest(hrp, nape, 0)
                task.wait(0.1)
                firetouchinterest(hrp, nape, 1)
                task.wait(0.3)
            end
            task.wait(0.05)
        end
    end
end

-- Start farming
task.spawn(autoFarm)
